## 1.1 基础环境准备

### 1.安装docker

为什么必须要使用docker？官方的页面给出了解释
现在ROS官方支持的版本只提供了arm和x86架构的，对riscv架构并没有提供官方的支持，但是官方提供了一个构建的思路。这是一种类似于“交叉编译”的思路，就是在docker中模拟出目标架构的环境然后从源码进行构建。[GitHub - ros-tooling/cross\_compile: A tool to build ROS and ROS2 workspaces for various targets](https://github.com/ros-tooling/cross_compile)但是这个提供的脚本依旧没有提供riscv的版本，而且已经在2022年停止了维护，如果想要实现的稳定的编译想必这不是一个好的选择。
![](https://weijiale.oss-cn-shanghai.aliyuncs.com/picgo/20251029094937448.png)
>[!note]
>这不是传统意义上的“交叉编译”，它必须在docker中使用qemu进行编译

#### 使用官方教程进行安装
至于docker的版本，现在docker也是十分的稳定，所以建议可以根据官网的教程下载最新的。[Install \| Docker Docs](https://docs.docker.com/engine/install)，按照上述教程进行安装即可。
>因为使用到了docker比较新的特性所以建议docker>=17.x.


```bash
➜  ~ docker --version
Docker version 29.1.1, build 0aedba5
➜  ~ docker buildx --help
Usage:  docker buildx [OPTIONS] COMMAND
Extended build capabilities with BuildKit
Options:
      --builder string   Override the configured builder instance
  -D, --debug            Enable debug logging
Management Commands:
  history     Commands to work on build records
  imagetools  Commands to work on images in registry
Commands:
  bake        Build from a file
  build       Start a build
  create      Create a new builder instance
  dial-stdio  Proxy current stdio streams to builder instance
  du          Disk usage
  inspect     Inspect current builder instance
  ls          List builder instances
  prune       Remove build cache
  rm          Remove one or more builder instances
  stop        Stop builder instance
  use         Set the current builder instance
  version     Show buildx version information
Run 'docker buildx COMMAND --help' for more information on a command.

```
出现相同的提示即为构建成功
### 2.启用docker buildx功能

```bash
# 启用 buildx 功能
sudo docker run --rm --privileged multiarch/qemu-user-static --reset -p yes
sudo docker buildx create --name riscv_ros_builder --use
sudo docker buildx inspect --bootstrap
```
![PixPin_2025-11-11_16-44-45.png|650](https://weijiale.oss-cn-shanghai.aliyuncs.com/picgo/20251111164453517.png)

### 3.安装qemu模拟器

因为docker buildx功能依赖于qemu，所以qemu是必须的
```bash
# Ubuntu/Debian
sudo apt-get update
sudo apt-get install -y qemu-user-static binfmt-support
```
![PixPin_2025-11-11_16-45-13.png|650](https://weijiale.oss-cn-shanghai.aliyuncs.com/picgo/20251111164518913.png)

安装完成之后可以使用如下命令进行测试

```bash
sudo docker run --rm --platform linux/riscv64 riscv64/ubuntu:22.04 uname -m
```
![PixPin_2025-11-11_16-46-15.png|650](https://weijiale.oss-cn-shanghai.aliyuncs.com/picgo/20251111164618315.png)

如果出现以下说明配置正确

```bash
riscv64
```

## 1.2构建编译脚本
 在官方的工具库中提供一个之前用于编译arm架构的脚本，虽然已经停止维护（官方支持arm架构，无需再编译了），但是脚本的构成仍然十分具有参考价值。
[GitHub - ros-tooling/cross\_compile: A tool to build ROS and ROS2 workspaces for various targets](https://github.com/ros-tooling/cross_compile)
所以我们的RISCV架构的脚本也基本按照上述思路进行编写，但是由于rosdep对于riscv架构的支持不够，所以我们仍需手动添加缺失的依赖库。这一工作十分繁琐，因为我们不知道这个RISCV到底在哪里会有依赖的缺失。这个试错的过程占据了前期脚本编写的大部分时间。

>[!important]
由于官方的仓库列表中有一些库是原生不支持riscv架构的，所以我fork了一个仓库，进行了支持riscv的维护。

所有编译需要用的到脚本和代码都已经开源到github。
## 1.3 运行环境准备

**以下操作是在开发板（运行环境）上进行！！！！！！！！！！！！！！！！！！**
本项目的运行环境：
- Milkv-meles
	- OS:revyos
	- RAM:16GB
	- CPU:C910
在运行环境中**最需要**注意的是python的版本，由于在riscv架构的系统上使用conda或者pyenv还有uv都是一件不怎么方便的事情，所以在一开始编译的时候一定确认好开发版的python环境，尽量保持大版本的一致。

如果你运行的过程中出现以下问题：
![PixPin_2025-12-23_18-48-34.png|650](https://weijiale.oss-cn-shanghai.aliyuncs.com/picgo/20251223191033585.png)
可以确实是由于python版本的不匹配造成的。

安装运行环境缺失的依赖，这个基本上可以按照构建脚本中的环境准备进行安装，只要在docker中能编译成功，在运行的时候一般不会有什么问题。

```bash
# 1.使用apt的包管理器进行安装
apt-get update && \
    apt-get install -y \
    build-essential cmake git curl wget \
    # Python 编译依赖 (必须全)
    libssl-dev zlib1g-dev libncurses5-dev libncursesw5-dev \
    libreadline-dev libsqlite3-dev libgdbm-dev libdb5.3-dev libbz2-dev \
    libexpat1-dev liblzma-dev libffi-dev uuid-dev \
    # ROS 2 核心 C++ 库
    libeigen3-dev libacl1-dev libldap-dev \
    liblttng-ust-dev liblttng-ctl-dev \
    libfmt-dev libspdlog-dev libtinyxml2-dev libasio-dev \
    libxml2-dev libxslt-dev libyaml-cpp-dev \
    libcurl4-openssl-dev libzip-dev libgts-dev libbullet-dev \
    libfreetype6-dev libopencv-dev ninja-build \
    libopencv-dev \
    libpcl-dev 
    
# 2.使用pip进行py的包安装
ENV PIP_BREAK_SYSTEM_PACKAGES=1

RUN pip3 install -U \
    colcon-common-extensions \
    vcstool \
    rosdepc \
    numpy \
    pyyaml==6.0.1 \
    lark==1.1.9 \
    empy==3.3.4 \
    catkin_pkg==1.0.0 \
    netifaces \
    typing_extensions \
    pytest==7.4.4
```

以上的具体内容请根据运行的时候进行调整。

